{"componentChunkName":"component---src-templates-post-template-jsx","path":"/posts/zabbix-mongo-key","webpackCompilationHash":"5b4853265c629787ff08","result":{"data":{"site":{"siteMetadata":{"title":"dongjinjo","subtitle":"Blog by dongjinjo","copyright":"© All rights reserved.","menu":[{"label":"Articles","path":"/"},{"label":"Categories","path":"/categories/"},{"label":"Tags","path":"/tags/"}],"author":{"name":"dongjin jo","twitter":"#"},"disqusShortname":"dongjinjo","url":"https://dongjinjo.github.io"}},"markdownRemark":{"id":"bc48a236-8ba2-50f5-b75a-37f271e87c30","html":"<blockquote>\n<p>Zabbix의 MongoDB 용 Key 생성 및 Item 설정 방법</p>\n</blockquote>\n<h2>Mongo 인증 설정</h2>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># /var/lib/zabbix/.mongo.rc</span>\n<span class=\"token keyword\">function</span> <span class=\"token function-name function\">authRequired</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  try <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>db.serverCmdLineOpts<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>.code <span class=\"token operator\">==</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin class-name\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token builtin class-name\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  catch <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin class-name\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>authRequired<span class=\"token punctuation\">(</span><span class=\"token punctuation\">))</span> <span class=\"token punctuation\">{</span>\n  try <span class=\"token punctuation\">{</span>\n    rs.slaveOk<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    var prev_db <span class=\"token operator\">=</span> db\n    db <span class=\"token operator\">=</span> db.getSiblingDB<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    db.auth<span class=\"token punctuation\">(</span><span class=\"token string\">''</span>, <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n    db <span class=\"token operator\">=</span> db.getSiblingDB<span class=\"token punctuation\">(</span>prev_db<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  catch <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin class-name\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>UserParameter.conf 추가</h2>\n<p>userParameter_mongo.conf</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.service,ps -ef <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> -v <span class=\"token function\">grep</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.network<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>,echo <span class=\"token string\">\"db.serverStatus().network\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token variable\">$1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f1 <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.opcounters<span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span>,echo <span class=\"token string\">\"db.serverStatus().opcounters\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token variable\">$1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.mem_resident,echo <span class=\"token string\">\"db.serverStatus().mem\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> resident <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.mem_virtual,echo <span class=\"token string\">\"db.serverStatus().mem\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> virtual <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f <span class=\"token number\">1</span><span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.mem_mapped,echo <span class=\"token string\">\"db.serverStatus().mem\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\b\">\\b</span>mapped<span class=\"token entity\" title=\"\\b\">\\b</span>'</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.connection_current,echo <span class=\"token string\">\"db.serverStatus().connections.current\"</span><span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.connection_available,echo <span class=\"token string\">\"db.serverStatus().connections.available\"</span><span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.queue_write,echo <span class=\"token string\">\"db.serverStatus().globalLock.currentQueue.writers\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span><span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.queue_reader,echo <span class=\"token string\">\"db.serverStatus().globalLock.currentQueue.readers\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span><span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.cursors_totalOpen,echo <span class=\"token string\">\"db.serverStatus().cursors.totalOpen\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.cursors_timedOut,echo <span class=\"token string\">\"db.serverStatus().cursors.timedOut\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.backgroundFlush,echo <span class=\"token string\">\"db.serverStatus().backgroundFlushing.last_ms\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.rpstatus,echo <span class=\"token string\">\"rs.status()\"</span><span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> myState<span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\":\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\",\"</span> -f <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\" \"</span> -f <span class=\"token number\">2</span>\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.pagefaults,echo <span class=\"token string\">\"db.serverStatus().extra_info.page_faults\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 3p\n<span class=\"token assign-left variable\">UserParameter</span><span class=\"token operator\">=</span>mongo.oplog_storetime,echo <span class=\"token string\">\"db.printReplicationInfo()\"</span> <span class=\"token operator\">|</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">HOME</span></span><span class=\"token operator\">=</span>/var/lib/zabbix mongo <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> -n 4p <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\"(\"</span> -f <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">\"h\"</span> -f <span class=\"token number\">1</span></code></pre></div>\n<h2>Item Key 설정 값</h2>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>key</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>connection available</td>\n<td>mongo.connection_available</td>\n</tr>\n<tr>\n<td>connection current</td>\n<td>mongo.connection_current</td>\n</tr>\n<tr>\n<td>page faults</td>\n<td>mongo.pagefaults</td>\n</tr>\n<tr>\n<td>queue reader</td>\n<td>mongo.queue_reader</td>\n</tr>\n<tr>\n<td>queue write</td>\n<td>mongo.queue_write</td>\n</tr>\n<tr>\n<td>service</td>\n<td>mongo.service</td>\n</tr>\n<tr>\n<td>disk used(%)</td>\n<td>vfs.fs.size[/var/lib/mongo, pused]</td>\n</tr>\n</tbody>\n</table>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://github.com/WuXianglong/Zabbix-Templates-Scripts/blob/master/mongo/mongo.conf\">https://github.com/WuXianglong/Zabbix-Templates-Scripts/blob/master/mongo/mongo.conf</a></li>\n<li><a href=\"https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2\">https://share.zabbix.com/databases/mongodb/mongodb-for-zabbix-3-2</a></li>\n</ul>","fields":{"categorySlug":"/categories/zabbix/","tagSlugs":["/tags/zabbix/","/tags/mongo/","/tags/monitoring/"],"slug":"/posts/zabbix-mongo-key"},"frontmatter":{"title":"MongoDB Key 생성 및 Item 설정","tags":["zabbix","mongo","monitoring"],"date":"2018-09-11T00:00:00.000Z","category":"zabbix","description":""}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/zabbix-mongo-key"}}}